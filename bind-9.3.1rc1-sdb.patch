--- bind-9.3.1rc1/configure.in.sdb	2005-02-16 22:25:08.000000000 -0500
+++ bind-9.3.1rc1/configure.in	2005-02-16 22:25:08.000000000 -0500
@@ -2194,6 +2194,8 @@
 	bin/check/Makefile
 	bin/named/Makefile
 	bin/named/unix/Makefile
+	bin/named_sdb/Makefile
+	bin/named_sdb/unix/Makefile
 	bin/rndc/Makefile
 	bin/rndc/unix/Makefile
 	bin/dig/Makefile
@@ -2215,6 +2217,7 @@
 	bin/tests/system/tkey/Makefile
 	bin/tests/headerdep_test.sh
 	bin/dnssec/Makefile
+	bin/sdb_tools/Makefile
 	doc/Makefile
 	doc/arm/Makefile
 	doc/arm/nominum-docbook-html.dsl
--- bind-9.3.1rc1/bin/named_sdb/main.c.sdb	2004-10-24 20:42:54.000000000 -0400
+++ bind-9.3.1rc1/bin/named_sdb/main.c	2005-02-16 22:25:08.000000000 -0500
@@ -71,6 +71,9 @@
  * Include header files for database drivers here.
  */
 /* #include "xxdb.h" */
+#include "ldapdb.h"
+#include "pgsqldb.h"
+#include "dirdb.h"
 
 static isc_boolean_t	want_stats = ISC_FALSE;
 static char		program_name[ISC_DIR_NAMEMAX] = "named";
@@ -656,7 +659,57 @@
 	 * Add calls to register sdb drivers here.
 	 */
 	/* xxdb_init(); */
-
+	result = ldapdb_init();
+	if (result != ISC_R_SUCCESS)
+	{
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_ERROR, 
+			  "SDB ldap module initialisation failed: %s.",
+			  isc_result_totext(result)
+		);
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_ERROR, 
+			  "SDB ldap zone database will be unavailable."
+		);
+	}else
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_NOTICE, "SDB ldap zone database module loaded."
+		         );
+	
+	result = pgsqldb_init();
+	if (result != ISC_R_SUCCESS)
+	{
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_ERROR, 
+			  "SDB pgsql module initialisation failed: %s.",
+			  isc_result_totext(result)
+		);
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_ERROR, 
+			  "SDB pgsql zone database will be unavailable."
+		);
+	}else
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_NOTICE, "SDB postgreSQL DB zone database module loaded."
+		         );
+		
+	result = dirdb_init();
+	if (result != ISC_R_SUCCESS)
+	{
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_ERROR, 
+			  "SDB directory DB module initialisation failed: %s.",
+			  isc_result_totext(result)
+		);
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_ERROR, 
+			  "SDB directory DB zone database will be unavailable."
+		);
+	}else
+	    isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
+			  ISC_LOG_NOTICE, "SDB directory DB zone database module loaded."
+		         );
+	       
 	ns_server_create(ns_g_mctx, &ns_g_server);
 }
 
@@ -673,6 +726,10 @@
 	 */
 	/* xxdb_clear(); */
 
+	ldapdb_clear();
+	pgsqldb_clear();
+	dirdb_clear();
+
 	isc_log_write(ns_g_lctx, NS_LOGCATEGORY_GENERAL, NS_LOGMODULE_MAIN,
 		      ISC_LOG_NOTICE, "exiting");
 	ns_log_shutdown();
--- bind-9.3.1rc1/bin/named_sdb/Makefile.in.sdb	2005-02-16 22:25:08.000000000 -0500
+++ bind-9.3.1rc1/bin/named_sdb/Makefile.in	2005-02-16 22:25:08.000000000 -0500
@@ -26,10 +26,10 @@
 #
 # Add database drivers here.
 #
-DBDRIVER_OBJS =
-DBDRIVER_SRCS =
+DBDRIVER_OBJS =      ldapdb.o     pgsqldb.o    dirdb.o
+DBDRIVER_SRCS =      ldapdb.c     pgsqldb.c    dirdb.c
 DBDRIVER_INCLUDES =
-DBDRIVER_LIBS =
+DBDRIVER_LIBS =      -lldap -llber  -lpq
 
 CINCLUDES =	-I${srcdir}/include -I${srcdir}/unix/include \
 		${LWRES_INCLUDES} ${DNS_INCLUDES} ${BIND9_INCLUDES} \
@@ -61,7 +61,7 @@
 
 SUBDIRS =	unix
 
-TARGETS =	named@EXEEXT@ lwresd@EXEEXT@
+TARGETS =	named_sdb@EXEEXT@
 
 OBJS =		aclconf.o builtin.o client.o config.o control.o \
 		controlconf.o interfacemgr.o \
@@ -114,14 +114,10 @@
 		-DNS_LOCALSTATEDIR=\"${localstatedir}\" \
 		-c ${srcdir}/config.c
 
-named@EXEEXT@: ${OBJS} ${UOBJS} ${DEPLIBS}
+named_sdb@EXEEXT@: ${OBJS} ${UOBJS} ${DEPLIBS}
 	${LIBTOOL_MODE_LINK} ${PURIFY} ${CC} ${CFLAGS} ${LDFLAGS} -o $@ \
 	${OBJS} ${UOBJS} ${LIBS}
 
-lwresd@EXEEXT@: named@EXEEXT@
-	rm -f lwresd@EXEEXT@
-	@LN@ named@EXEEXT@ lwresd@EXEEXT@
-
 doc man:: ${MANOBJS}
 
 docclean manclean maintainer-clean::
@@ -132,13 +128,8 @@
 
 installdirs:
 	$(SHELL) ${top_srcdir}/mkinstalldirs ${DESTDIR}${sbindir}
-	$(SHELL) ${top_srcdir}/mkinstalldirs ${DESTDIR}${mandir}/man5
-	$(SHELL) ${top_srcdir}/mkinstalldirs ${DESTDIR}${mandir}/man8
 
-install:: named@EXEEXT@ lwresd@EXEEXT@ installdirs
-	${LIBTOOL_MODE_INSTALL} ${INSTALL_PROGRAM} named@EXEEXT@ ${DESTDIR}${sbindir}
-	(cd ${DESTDIR}${sbindir}; rm -f lwresd@EXEEXT@; @LN@ named@EXEEXT@ lwresd@EXEEXT@)
-	${INSTALL_DATA} ${srcdir}/named.8 ${DESTDIR}${mandir}/man8
-	${INSTALL_DATA} ${srcdir}/lwresd.8 ${DESTDIR}${mandir}/man8
-	${INSTALL_DATA} ${srcdir}/named.conf.5 ${DESTDIR}${mandir}/man5
+install:: named_sdb@EXEEXT@ installdirs
+	${LIBTOOL_MODE_INSTALL} ${INSTALL_PROGRAM} named_sdb@EXEEXT@ ${DESTDIR}${sbindir}
+
 
--- bind-9.3.1rc1/bin/Makefile.in.sdb	2004-03-06 05:21:10.000000000 -0500
+++ bind-9.3.1rc1/bin/Makefile.in	2005-02-16 22:25:08.000000000 -0500
@@ -19,7 +19,7 @@
 VPATH =		@srcdir@
 top_srcdir =	@top_srcdir@
 
-SUBDIRS =	named rndc dig dnssec tests nsupdate check
+SUBDIRS =	named named_sdb rndc dig dnssec tests nsupdate check sdb_tools
 TARGETS =
 
 @BIND9_MAKE_RULES@
